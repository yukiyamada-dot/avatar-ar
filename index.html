<!doctype html>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Camera Permission Test</title>
<style>
  body{margin:0;background:#000;color:#fff;font:14px/1.5 system-ui;padding:16px}
  #v{width:100%;max-width:480px;aspect-ratio:4/3;background:#111}
  #log{white-space:pre-wrap;background:#111;padding:8px;border-radius:8px;margin-top:12px}
  button{padding:10px 14px;border:0;border-radius:10px}
</style>
<h1>Camera Permission Test</h1>
<p>Safariでこのページを直接開き、ボタンを押してください。</p>
<button id="btn">カメラを試す</button>
<video id="v" autoplay playsinline muted></video>
<pre id="log"></pre>
<script>
const v = document.getElementById('v');
const log = (...a)=>{document.getElementById('log').textContent += a.join(' ')+'\n';};
document.getElementById('btn').onclick = async () => {
  log('protocol:', location.protocol);
  try {
    // 背面→失敗ならフォールバック
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { exact:'environment' } }
    }).catch(()=> navigator.mediaDevices.getUserMedia({ video:true }));
    v.srcObject = stream;
    log('✅ getUserMedia success');
    // 3秒後に停止
    setTimeout(()=>stream.getTracks().forEach(t=>t.stop()), 3000);
  } catch(e) {
    log('❌ getUserMedia error:', e && e.message
