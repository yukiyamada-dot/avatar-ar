<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>Yuki WebAR (Markerless + Animation)</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <!-- Zappar for A-Frameï¼ˆiOS Safariå¯¾å¿œã®WebARã€‚é–‹ç™ºã¯ç„¡æ–™ãƒ»é€ã‹ã—å…¥ã‚Šï¼‰ -->
  <script src="https://libs.zappar.com/zappar-aframe/2.0.0/zappar-aframe.js"></script>

  <style>
    html, body { margin:0; height:100%; background:#000; }
    #ui {
      position: fixed; inset: 0; pointer-events:none; display:flex; align-items:flex-end; justify-content:center;
      padding: 16px;
    }
    #fixBtn, #placeBtn {
      pointer-events:auto; appearance:none; border:0; border-radius: 14px; padding: 12px 16px;
      font: 15px/1.2 system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background:#fff; color:#000; box-shadow: 0 6px 20px rgba(0,0,0,.25);
      margin: 0 8px;
    }
    #hint {
      position: fixed; left: 10px; top: 10px; color:#fff; font:12px/1.4 system-ui; opacity:.85;
      text-shadow: 0 1px 2px rgba(0,0,0,.6);
    }
  </style>
</head>
<body>
  <div id="hint">ğŸ“± ã‚«ãƒ¡ãƒ©è¨±å¯ â†’ å‘¨å›²ã‚’ã‚†ã£ãã‚Šè¦‹å›ã™ â†’ ä½ç½®ãŒå®‰å®šã—ãŸã‚‰ç”»é¢ã‚¿ãƒƒãƒ—ã§å›ºå®š</div>

  <!--
    zappar-camera: iOS Safariã§ã‚‚å‹•ãWebARã‚«ãƒ¡ãƒ©
    user-facing ã‚’ false ã«ã™ã‚‹ã¨èƒŒé¢ã‚«ãƒ¡ãƒ©å„ªå…ˆ
  -->
  <a-scene
    renderer="alpha:true; antialias:true; physicallyCorrectLights:true"
    vr-mode-ui="enabled:false"
    embedded
    loading-screen="enabled:false"
  >
    <a-entity
      id="zapparCamera"
      zappar-camera="user-facing:false"
      camera
    ></a-entity>

    <!-- ç°¡æ˜“ãƒ©ã‚¤ãƒˆ -->
    <a-entity light="type: directional; intensity: 1" position="1 2 1"></a-entity>
    <a-entity light="type: ambient; intensity: 0.5"></a-entity>

    <!--
      zappar-instant: ãƒãƒ¼ã‚«ãƒ¼ä¸è¦ã®â€œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°â€
      - placement-mode:true ã®é–“ã¯é…ç½®ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤ºã—ã€ã‚¿ãƒƒãƒ—ã§ falseï¼ˆå›ºå®šï¼‰ã«åˆ‡æ›¿
    -->
    <a-entity id="anchor" zappar-instant="placement-mode: true">
      <!-- é…ç½®ã‚¬ã‚¤ãƒ‰ï¼ˆç™½ã„ãƒªãƒ³ã‚°ï¼‰ -->
      <a-entity
        id="placement"
        geometry="primitive: ring; radiusInner: 0.08; radiusOuter: 0.1"
        rotation="-90 0 0"
        material="color: #ffffff; metalness:0.2; roughness:0.5; opacity:0.9"
      ></a-entity>

      <!-- ã‚ãªãŸã®GLBï¼ˆã‚¢ãƒ‹ãƒ¡å…¥ã‚Šï¼‰ã€‚å›ºå®šå¾Œã«è¦‹ãˆã‚‹ä½ç½®ãƒ»ã‚µã‚¤ã‚ºã«èª¿æ•´ -->
      <a-entity id="yuki"
        gltf-model="Yuki.glb"
        position="0 0 0"
        rotation="0 180 0"
        scale="0.6 0.6 0.6"
        visible="false"
        animation-mixer="clip: *; loop: repeat; timeScale: 1"
      ></a-entity>
    </a-entity>
  </a-scene>

  <!-- UIï¼ˆé…ç½®è§£é™¤ / å†é…ç½®ï¼‰ -->
  <div id="ui">
    <button id="placeBtn" style="display:none">ã“ã“ã«ç½®ãï¼ˆå›ºå®šï¼‰</button>
    <button id="fixBtn" style="display:none">ä½ç½®ã‚’èª¿æ•´</button>
  </div>

  <script>
    const anchor = document.getElementById('anchor');
    const yuki = document.getElementById('yuki');
    const placement = document.getElementById('placement');
    const placeBtn = document.getElementById('placeBtn');
    const fixBtn = document.getElementById('fixBtn');

    // é…ç½®ãƒ¢ãƒ¼ãƒ‰ä¸­ã¯ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤ºï¼†ãƒœã‚¿ãƒ³åˆ‡æ›¿
    function updateUI() {
      const isPlacing = anchor.getAttribute('zappar-instant').placementMode;
      placement.setAttribute('visible', isPlacing);
      placeBtn.style.display = isPlacing ? 'inline-block' : 'none';
      fixBtn.style.display = isPlacing ? 'none' : 'inline-block';
      yuki.setAttribute('visible', !isPlacing);
    }

    // åˆæœŸï¼šé…ç½®ãƒ¢ãƒ¼ãƒ‰ï¼ˆtrueï¼‰
    updateUI();

    // ç”»é¢ã‚¿ãƒƒãƒ—ã§ã‚‚å›ºå®šã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«
    document.body.addEventListener('click', (e) => {
      // ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—ã¯é™¤å¤–
      if (e.target === placeBtn || e.target === fixBtn) return;
      const isPlacing = anchor.getAttribute('zappar-instant').placementMode;
      if (isPlacing) {
        anchor.setAttribute('zappar-instant', 'placement-mode: false');
        updateUI();
      }
    });

    // ãƒœã‚¿ãƒ³ã§å›ºå®šï¼å†é…ç½®
    placeBtn.addEventListener('click', () => {
      anchor.setAttribute('zappar-instant', 'placement-mode: false');
      updateUI();
    });
    fixBtn.addEventListener('click', () => {
      anchor.setAttribute('zappar-instant', 'placement-mode: true');
      updateUI();
    });

    // ç«¯æœ«èµ·å‹•ç›´å¾Œã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè½ã¡ç€ãã¾ã§å°‘ã—å¾…ã£ã¦ã‹ã‚‰å¯è¦–åŒ–
    document.addEventListener('zappar-initialized', () => {
      // é…ç½®ã‚¬ã‚¤ãƒ‰ã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ã¾ã§ã®é«˜ã•ã‚’èª¿æ•´ã—ãŸã‘ã‚Œã° position ã‚’ç·¨é›†ã—ã¦ãã ã•ã„
    });
  </script>
</body>
</html>
