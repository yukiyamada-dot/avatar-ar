<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>Yuki WebAR (Markerless + Animation, iPhone)</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <!-- Zappar for A-Frame -->
  <script src="https://libs.zappar.com/zappar-aframe/2.0.0/zappar-aframe.js"></script>

  <style>
    html, body { margin:0; height:100%; background:#000; }
    #gate {
      position: fixed; inset:0; display:flex; align-items:center; justify-content:center;
      flex-direction:column; gap:12px; background:#000; color:#fff; z-index:9999; text-align:center; padding:24px;
    }
    #gate button {
      appearance:none; border:0; border-radius:14px; padding:12px 16px;
      font:15px/1.2 system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background:#fff; color:#000; box-shadow:0 6px 20px rgba(0,0,0,.25);
    }
    #hint {
      position:fixed; left:10px; top:10px; color:#fff; font:12px/1.4 system-ui; opacity:.85; z-index:10;
      text-shadow:0 1px 2px rgba(0,0,0,.6);
    }
    a-scene { display:none; }
  </style>
</head>
<body>
  <div id="hint">ğŸ“± Safariã§é–‹ã â†’ ä¸‹ã®ãƒœã‚¿ãƒ³ â†’ è¨±å¯ â†’ å‘¨å›²ã‚’ã‚†ã£ãã‚Šè¦‹å›ã™ â†’ å®‰å®šã—ãŸã‚‰ç”»é¢ã‚¿ãƒƒãƒ—ã§å›ºå®š</div>

  <!-- äº’æ›æ€§ï¼†æ¨©é™UIï¼ˆZapparå…¬å¼ï¼‰ -->
  <zappar-compatibility-ui></zappar-compatibility-ui>
  <zappar-permission-ui></zappar-permission-ui>

  <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§ç¢ºå®Ÿã«è¨±å¯ã‚’å–ã‚‹ã‚²ãƒ¼ãƒˆ -->
  <div id="gate">
    <div>ARã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã‚«ãƒ¡ãƒ©è¨±å¯ãŒå¿…è¦ã§ã™ã€‚<br><b>Safariã§ç›´æ¥</b>ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã€ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</div>
    <button id="startBtn">ARã‚’é–‹å§‹</button>
    <div style="opacity:.75; font-size:12px">ã†ã¾ãã„ã‹ãªã„æ™‚ï¼šè¨­å®šâ–¶Safariâ–¶ã‚«ãƒ¡ãƒ©ã‚’è¨±å¯ï¼ã“ã®ã‚µã‚¤ãƒˆã®è¨­å®šã§ã‚«ãƒ¡ãƒ©è¨±å¯ï¼httpsã§ã‚¢ã‚¯ã‚»ã‚¹</div>
  </div>

  <!-- A-Frame + Zapparï¼ˆãƒãƒ¼ã‚«ãƒ¼ãƒ¬ã‚¹ï¼‰ -->
  <a-scene id="scene"
    renderer="alpha:true; antialias:true; physicallyCorrectLights:true"
    vr-mode-ui="enabled:false" embedded loading-screen="enabled:false">

    <!-- èƒŒé¢ã‚«ãƒ¡ãƒ©å„ªå…ˆ -->
    <a-entity id="zapparCamera" zappar-camera="user-facing:false" camera></a-entity>

    <!-- ãƒ©ã‚¤ãƒˆ -->
    <a-entity light="type: directional; intensity: 1" position="1 2 1"></a-entity>
    <a-entity light="type: ambient; intensity: 0.6"></a-entity>

    <!-- ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° -->
    <a-entity id="anchor" zappar-instant="placement-mode: true">
      <!-- é…ç½®ã‚¬ã‚¤ãƒ‰ -->
      <a-entity id="placement"
        geometry="primitive: ring; radiusInner: 0.08; radiusOuter: 0.1"
        rotation="-90 0 0"
        material="color:#ffffff; metalness:0.2; roughness:0.5; opacity:0.9">
      </a-entity>

      <!-- GLBï¼ˆã‚¢ãƒ‹ãƒ¡ï¼‰â€»ã‚¹ã‚±ãƒ¼ãƒ«å°ã•ã‚ -->
      <a-entity id="yuki"
        gltf-model="Yuki.glb"
        position="0 0 0"
        rotation="0 180 0"
        scale="0.08 0.08 0.08"
        visible="false"
        animation-mixer="clip:*; loop:repeat; timeScale:1">
      </a-entity>
    </a-entity>
  </a-scene>

  <script>
    const gate = document.getElementById('gate');
    const scene = document.getElementById('scene');
    const anchor = document.getElementById('anchor');
    const placement = document.getElementById('placement');
    const yuki = document.getElementById('yuki');

    function updateUI(){
      const isPlacing = anchor.getAttribute('zappar-instant').placementMode;
      placement.setAttribute('visible', isPlacing);
      yuki.setAttribute('visible', !isPlacing);
    }

    // ç”»é¢ã‚¿ãƒƒãƒ—ã§å›ºå®š
    document.body.addEventListener('click', (e)=>{
      if (gate.style.display !== 'none') return;
      const isPlacing = anchor.getAttribute('zappar-instant').placementMode;
      if (isPlacing) {
