document.getElementById('startBtn').addEventListener('click', async () => {
  try {
    const granted = await ZapparAFrame.permission.requestCameraPermissionsAsync();
    console.log("Zappar permission result:", granted);
    if (!granted) {
      alert("Zappar permission API: 拒否されました");
      return;
    }
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: 'environment' } } })
      .catch(e => {
        console.error("背面指定失敗:", e);
        return navigator.mediaDevices.getUserMedia({ video: true });
      });
    console.log("getUserMedia stream:", stream);
    stream.getTracks().forEach(t => t.stop());

    document.getElementById('gate').style.display = 'none';
    document.getElementById('scene').style.display = 'block';
  } catch (e) {
    alert("getUserMedia error: " + (e && e.message ? e.message : e));
    console.error(e);
  }
});
